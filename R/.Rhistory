danny_params$vars$TEMP_AType <- 2
danny_params$graphs$TEMP_MonthAvg$xy_data$TEMP_MonthAvg$x_val <-
c(1,
31.33,
61.67,
92,
122.33,
152.67,
183,
213.33,
243.67,
274,
304.33,
334.67,
365)
danny_params$graphs$TEMP_MonthAvg$xy_data$TEMP_MonthAvg$y_val <-
c(21.80,
21.70,
21.70,
21.90,
21.80,
21.10,
20.40,
20.40,
21.30,
22.40,
22.40,
21.80,
21.80)
danny_params$graphs$TEMP_AirDailyData$xy_data$TEMP_AirDailyData$x_val <-
c(1,
34.09,
67.18,
100.27,
133.36,
166.45,
199.55,
232.64,
265.73,
298.82,
331.91,
365)
danny_params$graphs$TEMP_AirDailyData$xy_data$TEMP_AirDailyData$y_val <-
c(24.10,
23.90,
24.00,
24.30,
23.20,
22.40,
22.40,
23.50,
24.90,
24.80,
24.10,
28.10)
danny_params$arrays$calender_df$vars$EVAP_MonthlyMean_AirTemp <-
c(27.60,
27.30,
27.30,
27.30,
27.00,
26.30,
25.80,
25.70,
26.30,
27.60,
28.40,
28.10
)
danny_params$arrays$calender_df$vars$EVAP_MonthlyMean_DayLength <-
c(12.30,
12.20,
12.10,
12.00,
11.90,
11.80,
11.90,
11.90,
12.00,
12.20,
12.30,
12.30
)
# sloping land
danny_params$vars$AF_SlopeSurfInit <- 1
danny_params$vars$AF_PlotNumberUphill <- 1
danny_params$vars$AF_RunOnFrac <- 0.01
# management
# soil tillage
danny_params$graphs$E_PloughDoY$xy_data$E_PloughDoY$y_val <-
c(364, 122, 180, 240, 300, 360, 0, 257.33, 0, 167.9, rep(0, 31))
# SOM pools
danny_params$vars$MC2_SomInitType <- 2
danny_params$vars$MC2_CorgpCref <- 0.6
# CN ratio
danny_params$vars$MN_CNPass <- 15
# SOM transfer
danny_params$arrays$cpools_df$vars$MC2_RainTransfer <- c(0,0,0,0,0.001)
danny_params$arrays$cpools_df$vars$MC2_SoilTillTransfer <- rep(0, 5)
# pruning
danny_params$arrays$treestage_df$vars$T_StageAftPrun_is <- rep(0, 6)
# tapping
danny_params$vars$T_TappingFrac <- 0.6
# kill
danny_params$arrays$tree_df$vars$T_KillY <- c(100, 100, 100)
danny_params$arrays$tree_df$vars$T_Kill2Y <- c(100, 100, 100)
danny_params$arrays$tree_df$vars$T_Kill3Y <- c(100, 100, 100)
# erosion
danny_params$vars$E_SoilMovperPlou <-  399
# maint respiration
danny_params$vars$C_RespperBiom <- 0.05
# soil evaporation
danny_params$vars$TEMP_AType <- 2
danny_params$arrays$tree_df$vars$T_klight
TW_v <- c("TW_DemandPot", "TW_EnergyDrivenEpot_is", "EVAP_TreeWatDem", "T_TranspRatioConstant_is", "T_Light", "T_GroMax", "T_TranspRatio", "TP_WaterDemand", "T_TranspRatioTime")
EVAP <- c("EVAP_TreeWatDem", "EVAP_EpotDemandNotMetBy_CanInterc", "LIGHT_TCap1234")
light <- c("LIGHT_TCap1234", "LIGHT_TCap", "LIGHT_TCCap",  "LIGHT_LAIT", "T_LAIEff", "T_CanUp", "L_Can", "T_WoodH", "T_CanH", "T_CanShape", "T_CanWidth", "T_CanWidthRel",
"T_LAI", "T_LAIMin", "T_CanWidthMaxRel")
lai <- c("T_LAI", "T_LAIMax", "T_LfTwig", "T_LWR", "T_SLA", "T_LeavesPotPresent")
# treepcomp_df["T_LfTwig"] <- treepcomp_df[["T_LfTwig"]] + treepcomp_df[["T_CanBiomInc"]] + treepcomp_df[["T_CanBiomIni"]] - treepcomp_df[["T_Prun"]] - treepcomp_df[["T_LifallInc"]] - treepcomp_df[["T_WoodInc"]] - treepcomp_df[["T_Herbivory"]] - treepcomp_df[["T_CanBiomSlashed"]] - treepcomp_df[["T_CanBiomTimHarv"]]
Twig <- c("T_LfTwig", "T_CanBiomInc", "T_CanBiomIni", "T_Prun", "T_LifallInc", "T_WoodInc", "T_Herbivory", "T_CanBiomSlashed", "T_CanBiomTimHarv")
T_WoodInc <- c("T_WoodInc",  "T_TargetLeafTwig", "T_LfTwig_DW", "T_Treesperha", "T_DiamLfTwig1", "T_SapWoodDiam", "T_DiamSlopeLfTwig")
T_SapWoodDiam <- c("T_SapWoodDiam",  "T_BiomAG_DW", "T_DiamSlopeBiom", "T_DiamBiom1", "T_LfTwig",  "T_SapWood", "T_GroRes", "T_BiomAG")
# treepcomp_df["T_GroRes"] <- treepcomp_df[["T_GroRes"]] + (
#   treepcomp_df[["T_GroResInc"]] - treepcomp_df[["T_CanBiomInc"]] - treepcomp_df[["T_FruitInc"]] - treepcomp_df[["T_LatexFormation"]] - treepcomp_df[["T_GroResLoss"]] - treepcomp_df[["T_Respiration"]] - treepcomp_df[["T_RootInc"]] - treepcomp_df[["T_GroResStorInc"]]
# )
T_GroRes <- c("T_GroRes",  "T_GroResInc", "T_CanBiomInc", "T_FruitInc", "T_LatexFormation",  "T_GroResLoss", "T_Respiration", "T_RootInc", "T_GroResStorInc")
T_GroResInc <- c("T_GroResInc", "T_DiesToday_is", "T_GroMax", "T_LightPosGrow",  "T_NPosgro_N", "T_NPosgro_P", "TW_Posgro")
T_NPosgro <- c("T_NPosgro", "T_NTargetNbiomRatio", "T_NTarget", "T_NBiom", "T_NTargetCan", "T_NTargetNonCan", "T_LfTwig_DW", "T_CanTargConc", "T_LfTwig")
TW_Posgro <- c("TW_Posgro", "TW_DemandPot", "TW_UptTot", "TP_WaterDemand",  "AF_RunWatLim_is")
W_Upt <- c("W_Upt", "TW_UptDeno", "TW_UptPot", "TW_DemandAct",  "W_TUptPotAct", "RT_TLrv")
T_TargetNonCan <- c("T_TargetNonCan", "T_Fruit_DW", "T_FruitConc", "T_GroRes_DW", "T_GroResConc", "T_RootPlCompTot_DW", "T_RtConc", "T_SapWood_DW", "T_LatexStock_DW", "T_HeartWood_DW", "T_WoodConc")
T_CanBiomInc <- c("T_CanBiomInc",  "T_LvsFormed_is", "T_LfTwig_DW", "T_FruitAllocStage", "T_RelFruitAllocMax",  "T_GroRes_DW", "T_RtAllocAct", "T_LfTwig", "T_GroResFrac",  "T_GroRes", "T_GrowsToday_is")
T_Biom <- c("T_Biom",  "T_GroRes", "T_LfTwig", "T_SapWood", "T_Fruit",  "T_RootPlCompTot", "T_HeartWood", "T_LatexStock")
T_Root <- c("T_Root",  "T_Root_Inc", "T_Root_decay", "RT_ATType", "T_Root_Inp_ZnL", "T_RootInc", "T_RelRtIncrTyp2", "T_Root_Dra_ZnL", "T_PlantTime", "RT_T_MeanResTime")
W_TUptPotAct <- c("W_TUptPotAct", "W_StockAcc", "W_TUptPot", "W_CUptPot", "W_PotUpt")
# zonelayerwater_df["W_PotUpt"] <- ifelse(
#   zonelayerwater_df[["W_WaterLimited_is"]] == 1,
#   ifelse(
#     zonelayerwater_df[["RT_Lrv"]] > 0,
#     pmin(zonelayerwater_df[["W_Theta_water_pair"]], zonelayerwater_df[["W_PotUpt_a"]]),
#     0
#   ),
#   ifelse(zonelayerwater_df[["RT_Lrv"]] > 0, zonelayerwater_df[["W_PotUpt_a"]], 0)
# )
W_PotUpt <- c("W_PotUpt", "W_WaterLimited_is", "W_Theta", "W_Alpha", "W_n", "W_ThetaSat", "W_Stock", "W_PoreVol", "W_BDLayer", "S_RelBD", "S_KsatInitV", "S_KsatDefV", "RT_Lrv", "RT_G", "W_PhiTheta", "W_PhiP", "W_PotUpt_a", "W_PhiP_x")
#TODO: W_Theta gak sama, karena W_Stock
W_Stock <- c("W_Stock", "W_In", "W_CUpt", "W_Upt", "EVAP_Surf", "W_VDrain", "W_Drain", "W_HRelDrain", "LF_VMaxDailyFlow", "LF_MaxVInflow", "W_WatDef")
EVAP_Surf <- c("EVAP_Surf", "W_MaxSoilEvap", "EVAP_PotSoilEvap", "EVAP_SlashEvap", "EVAP_RedFact", "SB_FirEvapSW", "W_Stock")
EVAP_RedFact <- c("EVAP_RedFact", "W_Theta", "W_ThetaInacc", "W_FieldCap", "C_LAI", "T_LAIEff", "MC_LAIperNecmss", "MC_Struc")
# MC_Struc[Zone](t) = MC_Struc[Zone](t - dt) + (MC_StrucIn[Zone] - MC_StrucActF[Zone] - MC_StrucSlwF[Zone] - MC_StrucSlwCO2In[Zone] - MC_StrucActCO2In[Zone] - MC_Str_LitSomTrans[Zone]) * dt
# zone_df["MC_Struc"] <- zone_df[["MC_Struc"]] + (zone_df[["MC_StrucIn"]] - zone_df[["MC_StrucActF"]] - zone_df[["MC_StrucSlwF"]] - zone_df[["MC_StrucSlwCO2In"]] - zone_df[["MC_StrucActCO2In"]] - zone_df[["MC_Str_LitSomTrans"]])
MC_Struc <- c("MC_Struc", "MC_StrucIn", "MC_StrucActF", "MC_StrucSlwF", "MC_StrucSlwCO2In", "MC_StrucActCO2In", "MC_Str_LitSomTrans", "MC_LitterC", "MC_MetabIn")
# zone_df["MC_LitterC"] <- MC_Carbon * 1000 * zone_df[["MC_LitterAmount"]] + zone_df[["CA_ExtOrgAppZn_sum"]
# zone_df["MC_LitterAmount"] <- zp_DW[["C_ResidMulch"]] + sum_df[["T_LifallInc_DW_WtAct"]] +
#   sum_df[["T_PrunMulch_DW_WtAct"]] + zp_DW[["SB_NecromLitTransf"]] + zp_DW[["SB_DeadWoodLitTransfer"]] /
#   1000
MC_LitterC <- c("MC_LitterC", "MC_LitterAmount", "C_ResidMulch", "T_LifallInc", "T_PrunMulch", "SB_NecromLitTransf", "SB_DeadWoodLitTransfer")
# treepcomp_df["T_LifallInc"] <- ifelse(
#   treepcomp_df[["T_ApplyPalm_is"]] == 0,
#   pmin(1, treepcomp_df[["T_LifallRedFac"]] * treepcomp_df[["T_LWR"]]) *
#     ((
#       treepcomp_df[["T_LfTwig"]] * (
#         treepcomp_df[["T_LeafAgeTurnover"]] + treepcomp_df[["T_LitFalFracDrought"]] + treepcomp_df[["T_PotSeasLiFallFrac"]] + treepcomp_df[["T_FBALitFal"]]
#       ) +
#         treepcomp_df[[""]] * treepcomp_df[["T_LitFalFracShade"]]
#     )),
#   treepcomp_df[["TF_LiFall"]] * treepcomp_df[["TF_LitFallRedFac"]] * TF_LiFall_ResWithdrawl
# )
T_LifallInc <- c("T_LifallInc", "T_LifallRedFac", "T_LWR", "T_LeafAgeTurnover", "T_LitFalFracDrought", "T_PotSeasLiFallFrac", "T_FBALitFal", "T_CanBiomInc", "T_LitFalFracShade")
T_GrowsToday_is <- c("T_GrowsToday_is", "AF_AnyTrees_is", "T_CumWatStress", "T_LiFallThreshWStress", "T_StressRatio", "T_PrunLapse", "T_PrunRecov", "T_Prun", "SB_SlashTime", "SB_FireTime_is")
T_CumWatStress <- c("T_CumWatStress", "T_DelWatStress", "T_WatStressMem", "TW_Posgro")
W_Phi <- c( "W_PhiP",  "W_pFS", "W_PRS", "CW_PotAct", "TW_PotRhizZn")
# zonetree_df["TW_PotRhizZn"] <- zonetree_df[["TW_PotAct"]] - (zonetree_df[["TW_DistAxialTransp"]] /
#                                                                zonetree_df[["TW_DistAxialTransp_mean"]]) * zonetree_df[["TW_DemandRedFac"]] * zonetree_df[["TW_PotLongitudinal"]]
TW_PotRhizZn <- c( "TW_PotRhizZn",  "TW_PotAct", "TW_DistAxialTransp", "TW_DistAxialTransp_mean", "TW_DemandRedFac", "TW_PotLongitudinal")
# tree_df["TW_DemandRedFac"] <- ifelse(tree_df[["TW_PotSuctHalf"]] != 0 &
#                                        tree_df[["TW_PotBest"]] != 0 &
#                                        (1 + (tree_df[["TW_PotBest"]] / tree_df[["TW_PotSuctHalf"]])^tree_df[["TW_m"]]) != 0,
#                                      1 / (1 + ((tree_df[["TW_PotBest"]]) / tree_df[["TW_PotSuctHalf"]])^tree_df[["TW_m"]]),
#                                      0)
# treebuf_df["TW_PotRange"] <- treebuf_df[["TW_PotSoilMeanPerceived"]] + treebuf_df[["TW_PotRadial"]] + treebuf_df[["TW_PotLongitudinal"]]
TW_DemandRedFac <- c( "TW_DemandRedFac",  "TW_PotSuctHalf", "TW_PotBest", "TW_m", "TW_Best_is", "TW_PotRange", "TW_PotSoilMeanPerceived", "TW_PotRadial",  "TW_PotLongitudinal")
# treebuf_df["TW_PU"] <- pmin(treebuf_df[["TW_DemandActRange"]], treebuf_df[["TW_PotUptOptAll"]])
TW_Best_is <- c( "TW_Best_is", "TW_MaxUptPot", "TW_PU", "TW_PU_before", "TW_DemandActRange", "TW_PotUptOptAll")
W_PotUptOptProfileZn <- c( "W_PotUptOptProfileZn", "TW_Water_Limited_is", "W_Theta", "TW_PotRhizTheta", "RT_T_RelImp", "W_PotUptOpt", "W_PotUptOpt_a", "W_PotUptOpt_b")
# zonelayertreebuf_df["W_PotUptOpt"] <- ifelse(
#   zonelayertreebuf_df[["RT_TC_G"]] != 0,
#   10 * pi * (pmax(
#     0, zonelayertreebuf_df[["W_PhiTheta"]] -
#       zonelayertreebuf_df[["TW_PhiPot"]]
#   )) * zonelayertreebuf_df[["RT_TC_G"]] * zonelayertreebuf_df[["RT_TLrv"]],
#   0
# )
W_PotUptOpt <- c( "W_PotUptOpt", "RT_TC_G", "W_PhiTheta", "TW_PhiPot", "RT_TLrv", "W_Theta")
# layertree_df["TW_PhiPot"] <- get_y(layertree_df[["TW_pFPotRhizOpt"]], "TW_PhiPotTL", mode = "pair")
TW_PhiPot <- c( "TW_PhiPot", "TW_pFPotRhizOpt", "TW_PotRhizOpt")
# zonetreebuf_df["TW_PotRhizOpt"] <- zonetreebuf_df[["TW_PotRange"]] - (1 - zonetreebuf_df[["TW_DemandRedFacRange"]]) *
#   (zonetreebuf_df[["TW_PotRadial"]] + zonetreebuf_df[["TW_PotLongitudinal"]]) -
#   (zonetreebuf_df[["TW_DistAxialTransp"]] / zonetreebuf_df[["Tw_DistAxialTranspMean"]]) * zonetreebuf_df[["TW_DemandRedFacRange"]] * zonetreebuf_df[["TW_PotLongitudinal"]]
# zt3b_df <- zonetreebuf_df[zonetreebuf_df[["tree_id"]] == 3, c("TW_PotRhizOpt", "TW_DemandRedFacRange", "TW_PotRadial")]
# zonetreebuf_df[zonetreebuf_df[["tree_id"]] == 3, "TW_PotRhizOpt"] <- zt3b_df[["TW_PotRhizOpt"]] - zt3b_df[["TW_DemandRedFacRange"]] * zt3b_df[["TW_PotRadial"]]
TW_PhiPot <- c( "TW_PotRhizOpt", "TW_PotRange", "TW_DemandRedFacRange", "TW_PotRadial", "TW_PotLongitudinal", "TW_DistAxialTransp", "Tw_DistAxialTranspMean")
# treebuf_df["TW_PotRange"] <- treebuf_df[["TW_PotSoilMeanPerceived"]] + treebuf_df[["TW_PotRadial"]] + treebuf_df[["TW_PotLongitudinal"]]
TW_PotRange <- c( "TW_PotRange", "TW_PotSoilMeanPerceived", "TW_PotRadial", "TW_PotLongitudinal")
# tree_df["TW_PotRadial"] <- ifelse(tree_df[["RT_TField"]] > 0 &
#                                     tree_df[["T_RootConductivity"]] > 0,
#                                   -tree_df[["TW_DemandPot"]] * 0.1 / (tree_df[["T_RootConductivity"]] * tree_df[["RT_TField"]]),
#                                   0)
TW_PotRadial <- c( "TW_PotRadial", "RT_TField", "T_RootConductivity", "TW_DemandPot")
# tree_df["TW_DemandPot"] <- ifelse(
#   tree_df[["TW_EnergyDrivenEpot_is"]] == 1,
#   tree_df[["EVAP_TreeWatDem"]] + tree_df[["TP_WaterDemand"]],
#   ifelse(
#     tree_df[["T_TranspRatioConstant_is"]] == 1,
#     tree_df[["T_Light"]] * tree_df[["T_GroMax"]] * tree_df[["T_TranspRatio"]] + tree_df[["TP_WaterDemand"]],
#     tree_df[["T_Light"]] * tree_df[["T_GroMax"]] * tree_df[["T_TranspRatio"]] /
#       tree_df[["T_TranspRatioTime"]] + tree_df[["TP_WaterDemand"]]
#   )
# )
TW_PotRadial <- c( "TW_DemandPot", "TW_EnergyDrivenEpot_is", "EVAP_TreeWatDem", "TP_WaterDemand", "T_TranspRatioConstant_is", "T_Light", "T_GroMax", "T_TranspRatio", "T_TranspRatioTime")
# zonetree_df["LIGHT_TCap1234"] <- ifelse(
#   zonetree_df[["LightSwitch"]] == 1 |
#     zonetree_df[["LightSwitch"]] == 2,
#   LIGHT_TCap_sum_df[["LIGHT_TCap"]] * zonetree_df[["RelLightCapPerZone"]],
#   LIGHT_TCap_sum_df[["LIGHT_TCap"]]
#
T_Light <- c( "T_Light", "LIGHT_TCap1234", "AF_ZoneFrac", "TW_DemandPot", "LightSwitch", "LIGHT_TCap", "RelLightCapPerZone", "LIGHT_TCCap", "T_klight", "LIGHT_LAIT", "LIGHT_sp", "LIGHT_TBAI")
# zonelayertree_df["LIGHT_LAIT"] <- ifelse(zonelayertree_df[["T_LAIEff"]] > 0, zonelayertree_df[["T_LAIEff"]] * pmax(0, (
#   pmin(zonelayertree_df[["T_CanUp"]], zonelayertree_df[["L_Can"]]) -
#     pmax(zonelayertree_df[["L_Can_down"]], zonelayertree_df[["T_CanLow"]])
# ) / (
#   zonelayertree_df[["T_CanUp"]] - zonelayertree_df[["T_CanLow"]]
# )), 0)
LIGHT_LAIT <- c( "LIGHT_LAIT", "T_LAIEff", "T_CanUp", "L_Can", "L_Can_down", "T_CanLow")
# zonetree_df["T_LAIEff_a"] <- 1 - zonetree_df[["T_RelCanWidthZn"]] * (1 - exp(-zonetree_df[["T_klight"]] * zonetree_df[["T_LAICan"]]))
# zonetree_df["T_LAIEff"] <- ifelse(zonetree_df[["T_klight"]] > 0 &
#                                     zonetree_df[["T_LAIEff_a"]] > 0,
#                                   -log(zonetree_df[["T_LAIEff_a"]]) / zonetree_df[["T_klight"]],
#                                   0)
T_LAIEff <- c( "T_LAIEff", "T_klight", "T_RelCanWidthZn", "T_LAICan", "L_Can_down", "T_CanLow")
# zonetree_df["AF_RelZoneTreeLeft"] <- (1 - zonetree_df[["T_RelPosinZone"]]) *
#   zonetree_df[["AF_ZoneTreeLeftRight"]]
# zonetree_df["AF_RelZoneTreeNext2Left"] <- ifelse(zonetree_df[["AF_TreePosit"]] == zonetree_df[["AF_ZoneTree"]] - 2, zonetree_df[["AF_ZoneFrac"]], 0)
# zonetree_df["AF_RelZoneTreeNext2Right"] <-  ifelse(zonetree_df[["AF_TreePosit"]] == zonetree_df[["AF_ZoneTree"]] + 2, zonetree_df[["AF_ZoneFrac"]], 0)
# zonetree_df["AF_RelZoneTreeNextLeft"] <- ifelse(zonetree_df[["AF_TreePosit"]] == zonetree_df[["AF_ZoneTree"]] - 1, zonetree_df[["AF_ZoneFrac"]], 0)
# zonetree_df["AF_RelZoneTreeNextRight"] <- ifelse(zonetree_df[["AF_TreePosit"]] ==  zonetree_df[["AF_ZoneTree"]] + 1, zonetree_df[["AF_ZoneFrac"]], 0)
# zonetree_df["AF_RelZoneTreeRight"] <- zonetree_df[["T_RelPosinZone"]] * zonetree_df[["AF_ZoneTreeLeftRight"]]
#
# zonetree_df["T_RelCanWidthZn"] <-
#   ifelse (zonetree_df[["AF_ZoneFrac"]] == 0, 0, ifelse (zonetree_df[["T_TreeinZone"]] == 1, pmin(1, (
#     pmax(0, pmin(
#       zonetree_df[["T_RelPosinZone"]] * zonetree_df[["AF_ZoneFrac"]], zonetree_df[["T_CanWidthRel"]]
#     )) +
#       pmax(0, pmin((1 - zonetree_df[["T_RelPosinZone"]]) * zonetree_df[["AF_ZoneFrac"]], zonetree_df[["T_CanWidthRel"]]
#       ))
#   ) / zonetree_df[["AF_ZoneFrac"]])
#   , pmax(0, pmin(
#     1, (
#       zonetree_df[["T_CanWidthRel"]] -
#         (
#           zonetree_df[["T_Tree1ToTheLeft"]] * zonetree_df[["AF_RelZoneTreeLeft"]] +
#             zonetree_df[["T_Tree2ToTheLeft"]] * zonetree_df[["AF_RelZoneTreeNextLeft"]] +
#             zonetree_df[["T_Tree3ToTheLeft"]] * zonetree_df[["AF_RelZoneTreeNext2Left"]] +
#             zonetree_df[["T_Tree1ToTheRight"]] * zonetree_df[["AF_RelZoneTreeRight"]] +
#             zonetree_df[["T_Tree2ToTheRight"]] * zonetree_df[["AF_RelZoneTreeNextRight"]] +
#             zonetree_df[["T_Tree3ToTheRight"]] * zonetree_df[["AF_RelZoneTreeNext2Right"]]
#         )
#     ) / zonetree_df[["AF_ZoneFrac"]]
#   ))))
T_RelCanWidthZn <- c( "T_RelCanWidthZn", "T_TreeinZone", "T_RelPosinZone", "T_CanWidthRel", "AF_TreePosit", "AF_ZoneTree", "AF_ZoneTreeLeftRight", "T_Tree3ToTheRight")
#TODO: next to be traced: TW_PotUptOptAll
# run simulation
out <- run_wanulcas(n_iteration = 20, wanulcas_params = danny_params, output_vars = T_RelCanWidthZn)
zt <- out$zonetree_df
zt[zt$zone == 1 & zt$tree_id == 1 ,]
show_zone_zt <- function(v) {
zt <- out$zonetree_df
zt1 <- zt[zt$tree_id == 1 ,]
cbind(zt1[zt1$zone == 1, "time"], zt1[zt1$zone == 1, ..v], zt1[zt1$zone == 2, ..v], zt1[zt1$zone == 3, ..v], zt1[zt1$zone == 4, ..v])
}
show_zone_zt("T_RelCanWidthZn")
# set the active folder similar with this file
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# call the wanulcas function library
source("wanulcas.R")
# dany par: Ca_FertAmount, T_PrunDoY, T_PrunFracD, T_PrunHarvFracD, T_PrunY
danny_params <- default_params
danny_params <- apply_xls_params("Wanulcas_danny.xlsx", danny_params)
# TODO: stella bugs?
# AF_DepthLay1 = AF_System[SL1]
# AF_DepthLay2 = AF_System[SL2]
# AF_DepthLay3 = AF_System[SL3]
# AF_DepthLay4 = AF_System[SL1]
danny_params$arrays$layer_df$vars$AF_DepthLay[4] <- danny_params$arrays$layer_df$vars$AF_DepthLay[1]
# rainfall
danny_params$vars$RAIN_AType <- 4
danny_params$vars$RAIN_CoefVar4 <- 0.1
danny_params$graphs$RAIN_MonthTot$xy_data$RAIN_MonthTot$x_val <-
c(
0,
33.42,
60.83,
91.25,
121.67,
152.08,
182.50,
212.92,
243.33,
273.75,
304.17,
334.58,
365
)
danny_params$graphs$RAIN_MonthTot$xy_data$RAIN_MonthTot$y_val <-
c(
332.20,
341.50,
277.60,
207.20,
93.10,
38.10,
27.70,
23.80,
13.20,
85.70,
249.70,
357.10,
357.10
)
# temperature
danny_params$vars$TEMP_AType <- 2
danny_params$graphs$TEMP_MonthAvg$xy_data$TEMP_MonthAvg$x_val <-
c(1,
31.33,
61.67,
92,
122.33,
152.67,
183,
213.33,
243.67,
274,
304.33,
334.67,
365)
danny_params$graphs$TEMP_MonthAvg$xy_data$TEMP_MonthAvg$y_val <-
c(21.80,
21.70,
21.70,
21.90,
21.80,
21.10,
20.40,
20.40,
21.30,
22.40,
22.40,
21.80,
21.80)
danny_params$graphs$TEMP_AirDailyData$xy_data$TEMP_AirDailyData$x_val <-
c(1,
34.09,
67.18,
100.27,
133.36,
166.45,
199.55,
232.64,
265.73,
298.82,
331.91,
365)
danny_params$graphs$TEMP_AirDailyData$xy_data$TEMP_AirDailyData$y_val <-
c(24.10,
23.90,
24.00,
24.30,
23.20,
22.40,
22.40,
23.50,
24.90,
24.80,
24.10,
28.10)
danny_params$arrays$calender_df$vars$EVAP_MonthlyMean_AirTemp <-
c(27.60,
27.30,
27.30,
27.30,
27.00,
26.30,
25.80,
25.70,
26.30,
27.60,
28.40,
28.10
)
danny_params$arrays$calender_df$vars$EVAP_MonthlyMean_DayLength <-
c(12.30,
12.20,
12.10,
12.00,
11.90,
11.80,
11.90,
11.90,
12.00,
12.20,
12.30,
12.30
)
# sloping land
danny_params$vars$AF_SlopeSurfInit <- 1
danny_params$vars$AF_PlotNumberUphill <- 1
danny_params$vars$AF_RunOnFrac <- 0.01
# management
# soil tillage
danny_params$graphs$E_PloughDoY$xy_data$E_PloughDoY$y_val <-
c(364, 122, 180, 240, 300, 360, 0, 257.33, 0, 167.9, rep(0, 31))
# SOM pools
danny_params$vars$MC2_SomInitType <- 2
danny_params$vars$MC2_CorgpCref <- 0.6
# CN ratio
danny_params$vars$MN_CNPass <- 15
# SOM transfer
danny_params$arrays$cpools_df$vars$MC2_RainTransfer <- c(0,0,0,0,0.001)
danny_params$arrays$cpools_df$vars$MC2_SoilTillTransfer <- rep(0, 5)
# pruning
danny_params$arrays$treestage_df$vars$T_StageAftPrun_is <- rep(0, 6)
# tapping
danny_params$vars$T_TappingFrac <- 0.6
# kill
danny_params$arrays$tree_df$vars$T_KillY <- c(100, 100, 100)
danny_params$arrays$tree_df$vars$T_Kill2Y <- c(100, 100, 100)
danny_params$arrays$tree_df$vars$T_Kill3Y <- c(100, 100, 100)
# erosion
danny_params$vars$E_SoilMovperPlou <-  399
# maint respiration
danny_params$vars$C_RespperBiom <- 0.05
# soil evaporation
danny_params$vars$TEMP_AType <- 2
danny_params$arrays$tree_df$vars$T_klight
### Checking vars ###############
TW_v <- c("TW_DemandPot", "TW_EnergyDrivenEpot_is", "EVAP_TreeWatDem", "T_TranspRatioConstant_is", "T_Light", "T_GroMax", "T_TranspRatio", "TP_WaterDemand", "T_TranspRatioTime")
EVAP <- c("EVAP_TreeWatDem", "EVAP_EpotDemandNotMetBy_CanInterc", "LIGHT_TCap1234")
light <- c("LIGHT_TCap1234", "LIGHT_TCap", "LIGHT_TCCap",  "LIGHT_LAIT", "T_LAIEff", "T_CanUp", "L_Can", "T_WoodH", "T_CanH", "T_CanShape", "T_CanWidth", "T_CanWidthRel",
"T_LAI", "T_LAIMin", "T_CanWidthMaxRel")
lai <- c("T_LAI", "T_LAIMax", "T_LfTwig", "T_LWR", "T_SLA", "T_LeavesPotPresent")
Twig <- c("T_LfTwig", "T_CanBiomInc", "T_CanBiomIni", "T_Prun", "T_LifallInc", "T_WoodInc", "T_Herbivory", "T_CanBiomSlashed", "T_CanBiomTimHarv")
T_WoodInc <- c("T_WoodInc",  "T_TargetLeafTwig", "T_LfTwig_DW", "T_Treesperha", "T_DiamLfTwig1", "T_SapWoodDiam", "T_DiamSlopeLfTwig")
T_SapWoodDiam <- c("T_SapWoodDiam",  "T_BiomAG_DW", "T_DiamSlopeBiom", "T_DiamBiom1", "T_LfTwig",  "T_SapWood", "T_GroRes", "T_BiomAG")
T_GroRes <- c("T_GroRes",  "T_GroResInc", "T_CanBiomInc", "T_FruitInc", "T_LatexFormation",  "T_GroResLoss", "T_Respiration", "T_RootInc", "T_GroResStorInc")
T_GroResInc <- c("T_GroResInc", "T_DiesToday_is", "T_GroMax", "T_LightPosGrow",  "T_NPosgro_N", "T_NPosgro_P", "TW_Posgro")
T_NPosgro <- c("T_NPosgro", "T_NTargetNbiomRatio", "T_NTarget", "T_NBiom", "T_NTargetCan", "T_NTargetNonCan", "T_LfTwig_DW", "T_CanTargConc", "T_LfTwig")
TW_Posgro <- c("TW_Posgro", "TW_DemandPot", "TW_UptTot", "TP_WaterDemand",  "AF_RunWatLim_is")
W_Upt <- c("W_Upt", "TW_UptDeno", "TW_UptPot", "TW_DemandAct",  "W_TUptPotAct", "RT_TLrv")
T_TargetNonCan <- c("T_TargetNonCan", "T_Fruit_DW", "T_FruitConc", "T_GroRes_DW", "T_GroResConc", "T_RootPlCompTot_DW", "T_RtConc", "T_SapWood_DW", "T_LatexStock_DW", "T_HeartWood_DW", "T_WoodConc")
T_CanBiomInc <- c("T_CanBiomInc",  "T_LvsFormed_is", "T_LfTwig_DW", "T_FruitAllocStage", "T_RelFruitAllocMax",  "T_GroRes_DW", "T_RtAllocAct", "T_LfTwig", "T_GroResFrac",  "T_GroRes", "T_GrowsToday_is")
T_Biom <- c("T_Biom", "T_Fruit", "T_SapWood",  "T_GroRes", "T_LfTwig", "T_HeartWood", "T_LatexStock",  "T_RootPlCompTot")
T_Root <- c("T_Root",  "T_Root_Inc", "T_Root_decay", "RT_ATType", "T_Root_Inp_ZnL", "T_RootInc", "T_RelRtIncrTyp2", "T_Root_Dra_ZnL", "T_PlantTime", "RT_T_MeanResTime")
W_TUptPotAct <- c("W_TUptPotAct", "W_StockAcc", "W_TUptPot", "W_CUptPot", "W_PotUpt")
W_PotUpt <- c("W_PotUpt", "W_WaterLimited_is", "W_Theta", "W_Alpha", "W_n", "W_ThetaSat", "W_Stock", "W_PoreVol", "W_BDLayer", "S_RelBD", "S_KsatInitV", "S_KsatDefV", "RT_Lrv", "RT_G", "W_PhiTheta", "W_PhiP", "W_PotUpt_a", "W_PhiP_x")
W_Stock <- c("W_Stock", "W_In", "W_CUpt", "W_Upt", "EVAP_Surf", "W_VDrain", "W_Drain", "W_HRelDrain", "LF_VMaxDailyFlow", "LF_MaxVInflow", "W_WatDef")
EVAP_Surf <- c("EVAP_Surf", "W_MaxSoilEvap", "EVAP_PotSoilEvap", "EVAP_SlashEvap", "EVAP_RedFact", "SB_FirEvapSW", "W_Stock")
EVAP_RedFact <- c("EVAP_RedFact", "W_Theta", "W_ThetaInacc", "W_FieldCap", "C_LAI", "T_LAIEff", "MC_LAIperNecmss", "MC_Struc")
MC_Struc <- c("MC_Struc", "MC_StrucIn", "MC_StrucActF", "MC_StrucSlwF", "MC_StrucSlwCO2In", "MC_StrucActCO2In", "MC_Str_LitSomTrans", "MC_LitterC", "MC_MetabIn")
MC_LitterC <- c("MC_LitterC", "MC_LitterAmount", "C_ResidMulch", "T_LifallInc", "T_PrunMulch", "SB_NecromLitTransf", "SB_DeadWoodLitTransfer")
T_LifallInc <- c("T_LifallInc", "T_LifallRedFac", "T_LWR", "T_LeafAgeTurnover", "T_LitFalFracDrought", "T_PotSeasLiFallFrac", "T_FBALitFal", "T_CanBiomInc", "T_LitFalFracShade")
T_GrowsToday_is <- c("T_GrowsToday_is", "AF_AnyTrees_is", "T_CumWatStress", "T_LiFallThreshWStress", "T_StressRatio", "T_PrunLapse", "T_PrunRecov", "T_Prun", "SB_SlashTime", "SB_FireTime_is")
T_CumWatStress <- c("T_CumWatStress", "T_DelWatStress", "T_WatStressMem", "TW_Posgro")
W_Phi <- c( "W_PhiP",  "W_pFS", "W_PRS", "CW_PotAct", "TW_PotRhizZn")
TW_PotRhizZn <- c( "TW_PotRhizZn",  "TW_PotAct", "TW_DistAxialTransp", "TW_DistAxialTransp_mean", "TW_DemandRedFac", "TW_PotLongitudinal")
TW_DemandRedFac <- c( "TW_DemandRedFac",  "TW_PotSuctHalf", "TW_PotBest", "TW_m", "TW_Best_is", "TW_PotRange", "TW_PotSoilMeanPerceived", "TW_PotRadial",  "TW_PotLongitudinal")
TW_Best_is <- c( "TW_Best_is", "TW_MaxUptPot", "TW_PU", "TW_PU_before", "TW_DemandActRange", "TW_PotUptOptAll")
W_PotUptOptProfileZn <- c( "W_PotUptOptProfileZn", "TW_Water_Limited_is", "W_Theta", "TW_PotRhizTheta", "RT_T_RelImp", "W_PotUptOpt", "W_PotUptOpt_a", "W_PotUptOpt_b")
W_PotUptOpt <- c( "W_PotUptOpt", "RT_TC_G", "W_PhiTheta", "TW_PhiPot", "RT_TLrv", "W_Theta")
TW_PhiPot <- c( "TW_PhiPot", "TW_pFPotRhizOpt", "TW_PotRhizOpt")
TW_PhiPot2 <- c( "TW_PotRhizOpt", "TW_PotRange", "TW_DemandRedFacRange", "TW_PotRadial", "TW_PotLongitudinal", "TW_DistAxialTransp", "Tw_DistAxialTranspMean")
TW_PotRange <- c( "TW_PotRange", "TW_PotSoilMeanPerceived", "TW_PotRadial", "TW_PotLongitudinal")
TW_PotRadial <- c( "TW_PotRadial", "RT_TField", "T_RootConductivity", "TW_DemandPot")
TW_PotRadial2 <- c( "TW_DemandPot", "TW_EnergyDrivenEpot_is", "EVAP_TreeWatDem", "TP_WaterDemand", "T_TranspRatioConstant_is", "T_Light", "T_GroMax", "T_TranspRatio", "T_TranspRatioTime")
T_Light <- c( "T_Light", "LIGHT_TCap1234", "AF_ZoneFrac", "TW_DemandPot", "LightSwitch", "LIGHT_TCap", "RelLightCapPerZone", "LIGHT_TCCap", "T_klight", "LIGHT_LAIT", "LIGHT_sp", "LIGHT_TBAI")
LIGHT_LAIT <- c( "LIGHT_LAIT", "T_LAIEff", "T_CanUp", "L_Can", "L_Can_down", "T_CanLow")
T_LAIEff <- c( "T_LAIEff", "T_klight", "T_RelCanWidthZn", "T_LAICan", "L_Can_down", "T_CanLow")
T_RelCanWidthZn <- c( "T_RelCanWidthZn", "T_TreeinZone", "T_RelPosinZone", "T_CanWidthRel", "AF_TreePosit", "AF_ZoneTree", "AF_ZoneTreeLeftRight", "T_Tree3ToTheRight")
#TODO: next to be traced: TW_PotUptOptAll
# run simulation
out <- run_wanulcas(n_iteration = 20, wanulcas_params = danny_params, output_vars = T_Biom)
tp <- as.data.frame(out$treepcomp_df)
tp[tp$tree_id == 1 & tp$PlantComp == "DW",]
shiny::runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
version()
version
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
shiny::runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
tab_df <- read.csv("config/input_tabs.csv")
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
runApp('D:/google_drive/ecomodels/code/R/shiny/wanulcas')
